<?php
/**
 * This module provide blocks to display js-view-coda maps
 *
 */
function landbook_vis_map_theme($existing, $type, $theme, $path){
    return array(
        'region_map' => array(
            'template' => 'block--landbook-vis-map--region-map',
            'render element' => 'elements'
        ),
        'world_map'  => array(
            'template' => 'block--landbook-vis-map--world-map',
            'render element' => 'elements'
        ),
        'compare_map'=> array(
            'template' => 'block--landbook-vis-map--compare-map',
            'render element' => 'elements'
        ),
    );
}

function landbook_vis_map_block_info() {
    $blocks['region_map'] = array(
        'info'          => t('Landbook: Country page: Region map'),
        'status'        => TRUE,
        'region'        => 'content',
        'visibility'    => BLOCK_VISIBILITY_LISTED,
        'pages'         => "book/countries/*",
        'weight'        => -52
    );
    $blocks['compare_map'] = array(
        'info'          => t('Landbook: Country page: Compare map'),
        'status'        => TRUE,
        'region'        => 'content',
        'visibility'    => BLOCK_VISIBILITY_LISTED,
        'pages'         => "book/countries/*\nbook/indicators/*\nbook/thematic/*",
        'weight'        => 12
    );
    $blocks['world_map'] = array(
        'info'          => t('Landbook: Countries: World map'),
        'status'        => TRUE,
        'region'        => 'content',
        'visibility'    => BLOCK_VISIBILITY_LISTED,
        'pages'         => "book/countries",
        'weight'        => -52
  );
  return $blocks;
}

function landbook_vis_map_block_view($delta = '') {
    $module_path = drupal_get_path('module', 'landbook_vis_map');

    $block = array();
    switch ($delta) {
    case 'region_map' :
        $block['subject'] = '<none>';
        $block['content'] = array(
            '#theme' => 'region_map',
            '#attached' => array(
                'library' => array(
                    array('landbook_view_coda', 'lbvis.map'),
                ),
                'js' =>  array(
                    $module_path . '/region-map.js' =>  array('weight' => 3, 'requires_jquery' => TRUE),
                )
            )
        );
        break;
    case 'compare_map' :
        $block['subject'] = t('Mapping');
        $block['content'] = array(
            '#theme' => 'compare_map',
            '#attached' => array(
                'library' => array(
                    array('landbook_view_coda', 'lbvis.map'),
                ),
                'js' =>  array(
                    $module_path . '/compare-map.js' =>  array('weight' => 3, 'requires_jquery' => TRUE),
                )
            )
        );
        break;
    case 'world_map' :
        $block['subject'] = '';
        $block['content'] = array(
            '#theme' => 'world_map',
            '#attached' => array(
                'library' => array(
                    array('landbook_view_coda', 'lbvis.map'),
                ),
                'js' =>  array(
                    $module_path . '/world-map.js' =>  array('weight' => 3, 'requires_jquery' => TRUE),
                )
            )
        );
        break;
    }
    return $block;
}
